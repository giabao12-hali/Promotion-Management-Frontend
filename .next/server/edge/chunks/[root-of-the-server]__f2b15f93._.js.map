{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\n\r\nconst protectedRoutes = ['/dashboard']\r\n\r\nexport function middleware (request: NextRequest) {\r\n    const {pathname} = request.nextUrl\r\n    const token = request.cookies.get('token')?.value;\r\n\r\n    // Bỏ qua nếu đã có callback URL để tránh loop\r\n    const hasCallbackUrl = request.nextUrl.searchParams.has('callbackUrl');\r\n\r\n    // kiểm tra các route đang được bảo vệ\r\n    const isProtectedRoute = protectedRoutes.some(route => pathname.startsWith(route));\r\n\r\n    // nếu chưa đăng nhập + truy cập vào protected route\r\n    if (isProtectedRoute && !token) {\r\n        console.log('Middleware - Redirecting to home with callback')\r\n        const callbackUrl = encodeURIComponent(pathname + request.nextUrl.search);\r\n        const homeUrl = new URL(`/?callbackUrl=${callbackUrl}`, request.url);\r\n        return NextResponse.redirect(homeUrl);\r\n    }\r\n\r\n    // nếu đã đăng nhập + truy cập vào home route + có callback URL\r\n    if (pathname === '/' && token && hasCallbackUrl) {\r\n        console.log('Middleware - User logged in, redirecting from home')\r\n        const callbackUrl = request.nextUrl.searchParams.get('callbackUrl');\r\n        const redirectUrl = callbackUrl ? decodeURIComponent(callbackUrl) : '/dashboard';\r\n        return NextResponse.redirect(new URL(redirectUrl, request.url));\r\n    }\r\n\r\n    return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n    matcher: [\r\n        /*\r\n            * Match all request paths except for the ones starting with:\r\n            * - api (API routes)\r\n            * - _next/static (static files)\r\n            * - _next/image (image optimization files)\r\n            * - favicon.ico (favicon file)\r\n            * - public folder\r\n        */\r\n       '/((?!api|_next/static|_next/image|favicon.ico|public).*)',\r\n    ],\r\n}"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,MAAM,kBAAkB;IAAC;CAAa;AAE/B,SAAS,WAAY,OAAoB;IAC5C,MAAM,EAAC,QAAQ,EAAC,GAAG,QAAQ,OAAO;IAClC,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;IAE5C,8CAA8C;IAC9C,MAAM,iBAAiB,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAExD,sCAAsC;IACtC,MAAM,mBAAmB,gBAAgB,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC;IAE3E,oDAAoD;IACpD,IAAI,oBAAoB,CAAC,OAAO;QAC5B,QAAQ,GAAG,CAAC;QACZ,MAAM,cAAc,mBAAmB,WAAW,QAAQ,OAAO,CAAC,MAAM;QACxE,MAAM,UAAU,IAAI,IAAI,CAAC,cAAc,EAAE,aAAa,EAAE,QAAQ,GAAG;QACnE,OAAO,gMAAY,CAAC,QAAQ,CAAC;IACjC;IAEA,+DAA+D;IAC/D,IAAI,aAAa,OAAO,SAAS,gBAAgB;QAC7C,QAAQ,GAAG,CAAC;QACZ,MAAM,cAAc,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;QACrD,MAAM,cAAc,cAAc,mBAAmB,eAAe;QACpE,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,aAAa,QAAQ,GAAG;IACjE;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC5B;AAEO,MAAM,SAAS;IAClB,SAAS;QACL;;;;;;;QAOA,GACD;KACF;AACL"}}]
}